!function(l,i){"use strict";function o(t,e){var o=this;i&&i.template&&i.media&&(o.$el=t,o.options=e,o.$elements=o.$el.find(o.options.elements),o.options.wpid=i.media.model.settings.post.id,o.$addbutton=o.$el.find(o.options.addbutton),o.$submitbox=o.$addbutton.parent(),o.$addbutton.on("click",l.proxy(o.add_block,o)),o.$elements.find(o.options.editbutton).on("click",l.proxy(o.edit_block,o)),o.$elements.find(o.options.removebutton).on("click",l.proxy(o.remove_block,o)),o.update_buttons())}o.prototype.$addbutton=null,o.prototype.$el=null,o.prototype.$elements=null,o.prototype.media=null,o.prototype.options=null,o.prototype.selections=null,o.prototype.$submitbox=null,o.prototype.add_block=function(t){t.preventDefault();var e=this;e._open_medialib({library:{type:e.options.type},multiple:e.options.multiple,title:e.options.title})},o.prototype.edit_block=function(t){t.preventDefault();var e=this,o=l(t.target||t.currentTarget).closest(e.options.item);e._open_medialib({library:{type:e.options.type},multiple:!1,title:e.options.title},o)},o.prototype.remove_block=function(t){t.preventDefault();var e=this,o=l(t.target||t.currentTarget).closest(e.options.item);o.css("background",e.options.color),o.animate({opacity:"0"},"slow",function(){o.remove(),e.update_buttons()})},o.prototype.update_buttons=function(){var t=this,e=t.$elements.find(t.options.item).length;1<=e&&!t.options.multiple&&t.$submitbox.hide(),e&&!t.options.multiple||t.$submitbox.show()},o.prototype._attach_items=function(t){var n=this;if(t.length){var s=i.template(n.options.source);l.each(t,function(t,e){if(!n.$elements.find(n.options.items+'[data-u="'+e.id+'"]').length){n.options.multiple||n.$elements.find(n.options.removebutton).click();var o={display:e.icon,height:0,id:e.id,name:""!=e.caption?e.caption:e.filename,url:e.url,width:0};"image"==n.options.type&&e.sizes&&(o.display=e.sizes[n.options.size]?e.sizes[n.options.size].url:e.url,o.height=e.sizes[n.options.size]?e.sizes[n.options.size].height:e.height,o.url=e.sizes[n.options.size]?e.sizes[n.options.size].url:e.url,o.width=e.sizes[n.options.size]?e.sizes[n.options.size].width:e.width);var i=l(s(o));i.find(n.options.editbutton).on("click",l.proxy(n.edit_block,n)),i.find(n.options.removebutton).on("click",l.proxy(n.remove_block,n)),n.$elements.append(i)}}),n.update_buttons()}},o.prototype._open_medialib=function(t,e){var o=this;if(o.media)return o._update_selectlist(e),void o.media.open();o.media=i.media.frames.file_frame=i.media(t),o._update_selectlist(e),o.media.on("select",function(){o.selections=o.media.state().get("selection"),o._attach_items(o.selections.toJSON()),i.media.model.settings.post.id=o.options.wpid}),o.media.open()},o.prototype._update_selectlist=function(e){var o=this;o.media.on("open",function(){var t=null!=e?e:o.$elements.find(o.options.item);t.length&&(o.selections=o.media.state().get("selection"),l.each(t,function(){var t=l(this).attr("data-u"),e=i.media.attachment(t);e.fetch(),o.selections.add(e?[e]:[])}))})};var e={init:function(t){if(!this.length)return!1;var e={color:"#ffaaaa",elements:".listbox",item:"fieldset",multiple:!1,addbutton:".add-button",editbutton:".edit-button",removebutton:".remove-button",media:null,title:!1,type:"image",wpid:null,size:"full",source:"template-id"};return this.each(function(){t&&l.extend(e,t),new o(l(this),e)})}};l.fn.dionysosUpload=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(l.error("Method "+t+" does not exist on dionysosUpload"),!1):e.init.apply(this,arguments)}}(window.jQuery,window.wp);